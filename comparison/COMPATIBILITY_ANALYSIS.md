# Compatibility Analysis: displaywidth, go-runewidth, and uniseg

> **Generated by:** Cursor IDE using Claude Sonnet 4.5, with a few edits by me (@clipperhouse)

## Summary

This document summarizes the compatibility findings between three Go libraries for Unicode string width calculation:

- [clipperhouse/displaywidth](https://github.com/clipperhouse/displaywidth) (this package)
- [mattn/go-runewidth](https://github.com/mattn/go-runewidth)
- [rivo/uniseg](https://github.com/rivo/uniseg)

### 1. Regional Indicator Pairs (Flags)

Regional indicator pairs (flags like ğŸ‡ºğŸ‡¸) are composed of two Regional Indicator symbols.

| Library | Behavior |
|--------|----------|
| **displaywidth** | Width 2 per flag (always, per Unicode TR51) |
| **go-runewidth** | Width 1 per flag (always) |
| **uniseg** | Width 2 per flag (always) |

**Example:** `ğŸ‡ºğŸ‡¸ğŸ‡¯ğŸ‡µğŸ‡¬ğŸ‡§` (3 flags)
- displaywidth: 6 columns (2+2+2)
- go-runewidth: 3 columns (1+1+1)
- uniseg: 6 columns (2+2+2)

### 2. Variation Selectors

**Variation selectors (VS15, VS16) affect emoji presentation:**

| Library | Behavior |
|---------|----------|
| **displaywidth** | Treats variation selectors as part of emoji (width 2) |
| **go-runewidth** | Treats variation selectors as separate characters (width 1 each) |
| **uniseg** | Treats variation selectors as part of emoji (width 2) |

**Example:** `â˜ºï¸âŒ›ï¸â¤ï¸` (3 emoji with variation selectors)
- displaywidth: 5 columns
- go-runewidth: 4 columns
- uniseg: 5 columns

### 3. Keycap Sequences

**Keycap sequences (digit/symbol + VS16 + combining enclosing keycap):**

Keycap sequences like 1ï¸âƒ£ are formed by: base character + variation selector (U+FE0F) + combining enclosing keycap (U+20E3).

| Library | Behavior | Width per Keycap |
|---------|----------|------------------|
| **displaywidth** | Treats as single wide emoji | 2 columns |
| **go-runewidth** | Treats base character only | 1 column |
| **uniseg** | Treats as single narrow character | 1 column |

**Example:** `1ï¸âƒ£#ï¸âƒ£` (2 keycap sequences)
- displaywidth: 4 columns (2 per keycap)
- go-runewidth: 2 columns (1 per keycap)
- uniseg: 2 columns (1 per keycap)

### 4. East Asian Ambiguous Width

**East Asian Ambiguous characters** (â˜…, Â°, Â±, etc.) can be rendered as either narrow (1 column) or wide (2 columns) depending on configuration.

| Library | Default | With EastAsianWidth=true |
|---------|---------|--------------------------|
| **displaywidth** | Width 1 | Width 2 |
| **go-runewidth** | Width 1 | Width 2 |
| **uniseg** | Width 1 | Width 2 (usually) |

**Example:** `â˜…Â°Â±` (3 ambiguous characters)
- displaywidth default: 3 columns
- displaywidth with EastAsianWidth=true: 6 columns
- go-runewidth default: 3 columns
- go-runewidth with EastAsianWidth=true: 6 columns
- uniseg default: 3 columns
- uniseg with EastAsianAmbiguousWidth=2: 5 columns (usually)

### 5. Regular Emojis

**Regular emojis (ğŸ˜€, ğŸš€, ğŸ‰, etc.) behave identically:**

| Library | Regular Emoji Width |
|---------|---------------------|
| **displaywidth** | Always 2 |
| **go-runewidth** | Always 2 |
| **uniseg** | Always 2 |

### 6. Basic Unicode Categories

Most Unicode categories show good compatibility.

| Category | displaywidth | go-runewidth | uniseg |
|----------|--------------|--------------|---------|
| ASCII | âœ… Compatible | âœ… Compatible | âœ… Compatible |
| Latin Extended | âœ… Compatible | âœ… Compatible | âœ… Compatible |
| CJK (Chinese/Japanese/Korean) | âœ… Compatible | âœ… Compatible | âœ… Compatible |
| Arabic | âœ… Compatible | âœ… Compatible | âœ… Compatible |
| Combining Marks | âœ… Compatible | âœ… Compatible | âœ… Compatible |
| Zero-Width Characters | âœ… Compatible | âœ… Compatible | âœ… Compatible |

## Detailed Test Results

> Run `go test -v` in the `comparison/` directory to see comprehensive behavior comparisons between libraries.

### Test Case: "Hello ä¸–ç•Œ! ğŸ˜€ğŸ‡ºğŸ‡¸"

**Breakdown:**
- "Hello " = 6 columns (ASCII)
- "ä¸–ç•Œ" = 4 columns (CJK, 2 each)
- "! " = 2 columns (ASCII)
- "ğŸ˜€" = 2 columns (emoji)
- "ğŸ‡ºğŸ‡¸" = 1-2 columns (flag, depends on library)

**Results:**
- displaywidth: 16 columns (flag = 2 columns)
- go-runewidth: 15 columns (flag = 1 column)
- uniseg: 16 columns (flag = 2 columns)

### Test Case: "ğŸš€ğŸš€ğŸš€" (3 rocket emoji)

**Results:**
- displaywidth: 6 columns (2 per emoji)
- go-runewidth: 6 columns (2 per emoji)
- uniseg: 6 columns (2 per emoji)
